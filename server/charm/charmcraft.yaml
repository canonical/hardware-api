type: charm
name: hardware-api
title: Hardware API
summary: Determine if a given hardware configuration is Ubuntu Certified.
description: |
  Hardware API is a RESTful API server that provides access to hardware
  information for a given machine. In particular, it helps you determine if a
  given hardware configuration is Ubuntu Certified, matches partially to a
  Certified system, or is not Certified.

  For more information on Hardware API, please visit the
  [official documentation](https://canonical-hardware-api.readthedocs-hosted.com/latest/).

  The official deployment of Hardware API is available on
  [hw.ubuntu.com](https://hw.ubuntu.com/).

links:
  contact: certification@canonical.com
  issues: https://github.com/canonical/hardware-api/issues
  source: https://github.com/canonical/hardware-api/tree/main/server/charm
  website: https://charmhub.io/hardware-api

base: ubuntu@22.04
platforms:
  amd64:

containers:
  hardware-api:
    resource: hardware-api-image

resources:
  hardware-api-image:
    type: oci-image
    description: OCI image for hardware-api
    upstream-source: ghcr.io/canonical/hardware-api/hwapi:main

requires:
  nginx-route:
    interface: nginx-route
    limit: 1
  traefik-route:
    interface: traefik_route
    limit: 1

charm-libs:
  - lib: traefik_k8s.traefik_route
    version: "0"
  - lib: nginx_ingress_integrator.nginx_route
    version: "0"

parts:
  hardware-api:
    plugin: uv
    source: .
    build-snaps: [astral-uv, rustup]
    override-build: |
      # pydantic requires a higher version of rustc than what is in the archive
      # Install rustc and cargo using rustup instead of the Ubuntu archive
      rustup set profile minimal
      rustup default stable

      craftctl default

config:
  options:
    log-level:
      description: |
        Configures log level for the server.
        Acceptable values are: "info", "debug", "warning", "error" and "critical"
      default: "info"
      type: string
    port:
      default: 30000
      description: The port to listen on for incoming HTTP requests.
      type: int
    hostname:
      default: hw
      description: External hostname for the service.
      type: string
